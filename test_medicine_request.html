<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Medicine Request API</title>
</head>
<body>
    <h1>Test Medicine Request API</h1>
    
    <form id="testForm">
        <div>
            <label for="patientName">Patient Name:</label>
            <input type="text" id="patientName" value="John Doe" required>
        </div>
        <div>
            <label for="contactNumber">Contact Number:</label>
            <input type="tel" id="contactNumber" value="1234567890" required>
        </div>
        <div>
            <label for="medicineName">Medicine Name:</label>
            <input type="text" id="medicineName" value="Paracetamol" required>
        </div>
        <div>
            <label for="dosage">Dosage:</label>
            <input type="text" id="dosage" value="500mg" required>
        </div>
        <div>
            <label for="quantity">Quantity:</label>
            <input type="number" id="quantity" value="10" required>
        </div>
        <div>
            <label for="urgency">Urgency:</label>
            <select id="urgency" required>
                <option value="routine">Routine</option>
                <option value="urgent">Urgent</option>
                <option value="emergency">Emergency</option>
            </select>
        </div>
        <div>
            <label for="formType">Form Type:</label>
            <select id="formType">
                <option value="tablets">Tablets</option>
                <option value="capsules">Capsules</option>
                <option value="liquid">Liquid</option>
            </select>
        </div>
        <div>
            <label for="doctorName">Doctor Name:</label>
            <input type="text" id="doctorName" value="Dr. Smith">
        </div>
        <div>
            <label for="medicalCondition">Medical Condition:</label>
            <textarea id="medicalCondition" required>Fever and headache</textarea>
        </div>
        <div>
            <label for="patientAge">Patient Age:</label>
            <input type="number" id="patientAge" value="30">
        </div>
        <div>
            <label for="allergies">Allergies:</label>
            <input type="text" id="allergies" value="None">
        </div>
        <div>
            <label for="additionalNotes">Additional Notes:</label>
            <textarea id="additionalNotes">Please deliver to home</textarea>
        </div>
        <button type="submit">Test API Request</button>
    </form>

    <div id="result"></div>

    <script>
        const API_BASE_URL = 'http://localhost:8000/api';
        
        // Get token from localStorage (assuming user is logged in)
        const token = localStorage.getItem('access_token');
        
        if (!token) {
            document.getElementById('result').innerHTML = '<p style="color: red;">Please login first to get access token</p>';
        }

        document.getElementById('testForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = '<p>Testing API request...</p>';
            
            try {
                const formData = {
                    patient_name: document.getElementById('patientName').value,
                    contact_number: document.getElementById('contactNumber').value,
                    medicine_name: document.getElementById('medicineName').value,
                    dosage: document.getElementById('dosage').value,
                    quantity: parseInt(document.getElementById('quantity').value),
                    urgency: document.getElementById('urgency').value,
                    form_type: document.getElementById('formType').value,
                    doctor_name: document.getElementById('doctorName').value,
                    medical_condition: document.getElementById('medicalCondition').value,
                    patient_age: document.getElementById('patientAge').value ? parseInt(document.getElementById('patientAge').value) : null,
                    allergies: document.getElementById('allergies').value,
                    additional_notes: document.getElementById('additionalNotes').value
                };
                
                console.log('Sending data:', formData);
                
                const response = await fetch(`${API_BASE_URL}/pharmacy/request/`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });
                
                console.log('Response status:', response.status);
                console.log('Response headers:', response.headers);
                
                const responseText = await response.text();
                console.log('Response text:', responseText);
                
                if (response.ok) {
                    const data = JSON.parse(responseText);
                    resultDiv.innerHTML = `<p style="color: green;">Success! Medicine request created with ID: ${data.id}</p>
                                        <pre>${JSON.stringify(data, null, 2)}</pre>`;
                } else {
                    resultDiv.innerHTML = `<p style="color: red;">Error: ${response.status} - ${responseText}</p>`;
                }
                
            } catch (error) {
                console.error('Error:', error);
                resultDiv.innerHTML = `<p style="color: red;">Error: ${error.message}</p>`;
            }
        });
    </script>
</body>
</html> 